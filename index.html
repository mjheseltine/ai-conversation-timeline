<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Timeline</title>

<style>
:root {
  --bg: #f6f7fb;
  --card: #fff;
  --muted: #6b7280;
  --accent: #1f6feb;
  --radius: 12px;
  --shadow: 0 4px 12px rgba(35, 40, 50, 0.08);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto;
}

body { background: var(--bg); margin: 20px; }
.container { max-width: 800px; margin: auto; }

.post {
  background: var(--card);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 16px;
  display: flex;
  gap: 12px;
  box-shadow: var(--shadow);
}

.avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  font-weight: 700;
  color: #fff;
}

.content { flex: 1; }

.meta {
  font-size: 13px;
  color: var(--muted);
}
.name { font-weight: 700; margin-right: 6px; }
.handle { color: var(--muted); }

.text { margin-top: 6px; font-size: 15px; line-height: 1.45; }

.thumb {
  width: 100%;
  border-radius: 10px;
  margin-top: 10px;
}

.actions {
  margin-top: 12px;
  display: flex;
  gap: 18px;
  color: var(--muted);
  font-size: 14px;
}
.actions button {
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 6px;
}
.actions button:hover { background: #f1f5f9; }

.liked { color: #e0245e; }
.retweeted { color: #17bf63; }

.view-link {
  display: inline-block;
  margin-top: 10px;
  padding: 8px 14px;
  background: var(--accent);
  color: white;
  border-radius: 8px;
  font-weight: 600;
  text-decoration: none;
}

/* ---- Inline comment box (timeline only) ---- */
.inline-comment {
  margin-top: 10px;
  display: none;
}
.inline-comment textarea {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #d4d4d8;
  padding: 8px;
  font-size: 14px;
}
.inline-comment button {
  margin-top: 6px;
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 7px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.highlight-mention { color: #1d4ed8; font-weight: 600; }
.highlight-hashtag { color: #059669; font-weight: 600; }
</style>
</head>

<body>
<div class="container" id="timeline"></div>

<script>
/* ---------------- Helpers ---------------- */
function initials(name) {
  return name.split(/\s+/).map(w => w[0]).join("").slice(0, 2).toUpperCase();
}
function colorFromName(name) {
  const colors = [
    "linear-gradient(135deg,#1f6feb,#3b82f6)",
    "linear-gradient(135deg,#10b981,#34d399)",
    "linear-gradient(135deg,#f59e0b,#fbbf24)",
    "linear-gradient(135deg,#ec4899,#f472b6)",
    "linear-gradient(135deg,#6366f1,#8b5cf6)"
  ];
  return colors[name.charCodeAt(0) % colors.length];
}
function highlight(text) {
  return text
    .replace(/(@[a-zA-Z0-9_]+)/g, '<span class="highlight-mention">$1</span>')
    .replace(/(#[a-zA-Z0-9_]+)/g, '<span class="highlight-hashtag">$1</span>');
}

/* ---------------- State ---------------- */
let timelineState = JSON.parse(
  sessionStorage.getItem("timelineState") || "{}"
);
function saveState() {
  sessionStorage.setItem("timelineState", JSON.stringify(timelineState));
}

/* ---------------- Load Posts ---------------- */
const timeline = document.getElementById("timeline");

fetch("data/posts.json")
  .then(r => r.json())
  .then(posts => {
    posts.forEach(p => timeline.appendChild(createPost(p)));
  });

/* ---------------- Create Post ---------------- */
function createPost(p) {

  let state = timelineState[p.id] || {
    likes: p.likes || 0,
    retweets: p.retweets || 0,
    comments: [],
    liked: false,
    retweeted: false
  };

  timelineState[p.id] = state;
  saveState();

  const wrap = document.createElement("article");
  wrap.className = "post";

  wrap.innerHTML = `
    <div class="avatar" style="background:${colorFromName(p.author)}">
      ${initials(p.author)}
    </div>

    <div class="content">
      <div class="meta">
        <span class="name">${p.author}</span>
        <span class="handle">${p.handle}</span> ¬∑ ${p.timestamp}
      </div>

      <div class="text">${highlight(p.text)}</div>
      ${p.image ? `<img src="${p.image}" class="thumb">` : ""}

      <div class="actions">
        <button class="like ${state.liked ? "liked" : ""}">
          ‚ù§Ô∏è <span>${state.likes}</span>
        </button>
        <button class="rt ${state.retweeted ? "retweeted" : ""}">
          üîÅ <span>${state.retweets}</span>
        </button>
        <button class="comment">
          üí¨ <span>${state.comments.length}</span>
        </button>
      </div>

      <div class="inline-comment">
        <textarea placeholder="Write a reply..."></textarea>
        <button>Post</button>
      </div>

      <a class="view-link" href="posts/post.html?id=${p.id}">
        View Conversation ‚Üí
      </a>
    </div>
  `;

  const likeBtn = wrap.querySelector(".like");
  const rtBtn = wrap.querySelector(".rt");
  const commentBtn = wrap.querySelector(".comment");
  const commentBox = wrap.querySelector(".inline-comment");
  const ta = commentBox.querySelector("textarea");
  const postBtn = commentBox.querySelector("button");

  likeBtn.onclick = () => {
    state.liked = !state.liked;
    state.likes += state.liked ? 1 : -1;
    likeBtn.classList.toggle("liked", state.liked);
    likeBtn.querySelector("span").textContent = state.likes;
    saveState();
  };

  rtBtn.onclick = () => {
    state.retweeted = !state.retweeted;
    state.retweets += state.retweeted ? 1 : -1;
    rtBtn.classList.toggle("retweeted", state.retweeted);
    rtBtn.querySelector("span").textContent = state.retweets;
    saveState();
  };

commentBtn.onclick = (e) => {
  e.stopPropagation(); // ‚õî prevent parent click handlers
  commentBox.style.display =
    commentBox.style.display === "none" ? "block" : "none";
  ta.focus();
};


  postBtn.onclick = () => {
    const txt = ta.value.trim();
    if (!txt) return;
    state.comments.push({
      text: txt,
      ts: Date.now()
    });
    ta.value = "";
    commentBox.style.display = "none";
    commentBtn.querySelector("span").textContent = state.comments.length;
    saveState();
  };

  return wrap;
}
</script>
</body>
</html>
