<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Timeline</title>

<style>
:root {
  --bg: #f6f7fb;
  --card: #fff;
  --muted: #6b7280;
  --accent: #1f6feb;
  --radius: 12px;
  --shadow: 0 4px 12px rgba(35, 40, 50, 0.08);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
    "Helvetica Neue", Arial;
}

body {
  background: var(--bg);
  margin: 20px;
}
.container {
  max-width: 800px;
  margin: auto;
}

.post {
  background: var(--card);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 16px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  box-shadow: var(--shadow);
  transition: transform 0.15s ease;
}
.post:hover {
  transform: translateY(-2px);
}

.avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  font-weight: 700;
  color: #fff;
  background: linear-gradient(135deg, #1f6feb, #3b82f6);
}

.content {
  flex: 1;
}
.meta {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 4px;
}
.name {
  font-weight: 700;
  margin-right: 6px;
}
.handle {
  color: var(--muted);
}

.text {
  margin-top: 6px;
  line-height: 1.4;
  font-size: 15px;
}

.thumb {
  width: 100%;
  border-radius: 10px;
  margin-top: 10px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s ease;
  object-fit: cover;
}
.thumb:hover {
  transform: scale(1.015);
}

.actions {
  margin-top: 12px;
  display: flex;
  gap: 20px;
  align-items: center;
  color: var(--muted);
  font-size: 14px;
}
.actions button {
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 6px;
}
.actions button:hover {
  background: #f1f5f9;
}
.actions .liked {
  color: #e0245e;
}
.actions .retweeted {
  color: #17bf63;
}

.view-link {
  display: inline-block;
  margin-top: 10px;
  padding: 8px 14px;
  background: var(--accent);
  color: white;
  border-radius: 8px;
  font-weight: 600;
  text-decoration: none;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.view-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
}

.highlight-mention {
  color: #1d4ed8;
  font-weight: 600;
}
.highlight-hashtag {
  color: #059669;
  font-weight: 600;
}
</style>
</head>

<body>
<div class="container" id="timeline"></div>

<script>
// ----------- Helpers -------------
function initials(name) {
  return name.split(/\s+/).map(w => w[0]).join("").slice(0, 2).toUpperCase();
}

function colorFromName(name) {
  const colors = [
    "linear-gradient(135deg,#1f6feb,#3b82f6)",
    "linear-gradient(135deg,#10b981,#34d399)",
    "linear-gradient(135deg,#f59e0b,#fbbf24)",
    "linear-gradient(135deg,#ec4899,#f472b6)",
    "linear-gradient(135deg,#6366f1,#8b5cf6)"
  ];
  return colors[name.charCodeAt(0) % colors.length];
}

function highlight(text) {
  return text
    .replace(/(@[a-zA-Z0-9_]+)/g, '<span class="highlight-mention">$1</span>')
    .replace(/(#[a-zA-Z0-9_]+)/g, '<span class="highlight-hashtag">$1</span>');
}

// ----------- Load State -------------
let timelineState = JSON.parse(sessionStorage.getItem("timelineState") || "{}");

function saveState() {
  sessionStorage.setItem("timelineState", JSON.stringify(timelineState));
}

// ----------- Load Posts -------------
const timeline = document.getElementById("timeline");

fetch("data/posts.json")
  .then(r => r.json())
  .then(posts => {
    posts.forEach(post => timeline.appendChild(createPost(post)));
  });

// ----------- Create Post -------------
function createPost(data) {

  // initial state
  let state = timelineState[data.id] || {
    likes: data.likes || 0,
    retweets: data.retweets || 0,
    comments: [],
    liked: false,
    retweeted: false
  };

  const wrapper = document.createElement("article");
  wrapper.className = "post";

  const avatar = document.createElement("div");
  avatar.className = "avatar";
  avatar.style.background = colorFromName(data.author);
  avatar.textContent = initials(data.author);

  const c = document.createElement("div");
  c.className = "content";

  c.innerHTML = `
    <div class="meta">
      <span class="name">${data.author}</span>
      <span class="handle">${data.handle}</span> ¬∑ 
      <span class="time">${data.timestamp}</span>
    </div>
    <div class="text">${highlight(data.text)}</div>
    ${data.image ? `<img src="${data.image}" class="thumb">` : ""}
  `;

  const actions = document.createElement("div");
  actions.className = "actions";
  actions.innerHTML = `
    <button class="like ${state.liked ? "liked" : ""}">‚ù§Ô∏è <span>${state.likes}</span></button>
    <button class="retweet ${state.retweeted ? "retweeted" : ""}">üîÅ <span>${state.retweets}</span></button>
    <button class="comment">üí¨ <span>${state.comments.length}</span></button>
  `;

  const view = document.createElement("a");
  view.href = `posts/post.html?id=${data.id}`;
  view.className = "view-link";
  view.textContent = "View Conversation ‚Üí";

  c.append(actions, view);

  // ------ Button Logic ------
  const [likeBtn, rtBtn, commentBtn] = actions.querySelectorAll("button");

  likeBtn.onclick = () => {
    state.liked = !state.liked;
    state.likes += state.liked ? 1 : -1;
    likeBtn.classList.toggle("liked", state.liked);
    likeBtn.querySelector("span").textContent = state.likes;
    timelineState[data.id] = state;
    saveState();
  };

  rtBtn.onclick = () => {
    state.retweeted = !state.retweeted;
    state.retweets += state.retweeted ? 1 : -1;
    rtBtn.classList.toggle("retweeted", state.retweeted);
    rtBtn.querySelector("span").textContent = state.retweets;
    timelineState[data.id] = state;
    saveState();
  };

  commentBtn.onclick = () => view.click();

  wrapper.append(avatar, c);
  return wrapper;
}

// Refresh timeline state on focus
window.addEventListener("focus", () => location.reload());
</script>

</body>
</html>
