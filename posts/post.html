<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Conversation</title>

<style>
:root {
  --bg:#f6f7fb;
  --card:#fff;
  --muted:#6b7280;
  --accent:#1f6feb;
  --radius:12px;
  --shadow:0 4px 12px rgba(35,40,50,0.08);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto;
}

body { background:var(--bg); margin:20px; }

.container { max-width:800px; margin:auto; }

.post {
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
  display:flex;
  gap:12px;
  margin-bottom:16px;
}

.avatar {
  width:48px;
  height:48px;
  border-radius:50%;
  display:grid;
  place-items:center;
  color:#fff;
  font-weight:700;
}

.content { flex:1; }

.meta {
  font-size:13px;
  color:var(--muted);
}

.name {
  font-weight:700;
  margin-right:6px;
}

.text {
  margin-top:6px;
  font-size:15px;
  line-height:1.45;
}

.thumb {
  width:100%;
  border-radius:10px;
  margin-top:10px;
}

.actions {
  margin-top:12px;
  display:flex;
  gap:20px;
  color:var(--muted);
}

.actions button {
  background:none;
  border:none;
  cursor:pointer;
  padding:4px 6px;
  border-radius:6px;
}

.actions button:hover { background:#f1f5f9; }

.liked { color:#e0245e; }
.retweeted { color:#17bf63; }

/* AI SUMMARY */
.ai-summary {
  background:#fffdf8;
  border:1px solid #fbe5b3;
}

/* USER COMMENT */
.user-comment {
  background:#f0f7ff;
  border:1px solid #dbeafe;
}

/* COMMENT BOX */
.comment-box {
  margin-top:14px;
}

.comment-box textarea {
  width:100%;
  min-height:80px;
  border-radius:8px;
  border:1px solid #d1d5db;
  padding:8px;
  font-size:14px;
}

.comment-controls {
  display:flex;
  gap:8px;
  margin-top:6px;
}

.comment-box button {
  background:var(--accent);
  color:white;
  border:none;
  padding:7px 14px;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}

/* EMOJI PANEL */
.emoji-panel {
  display:none;
  margin-top:6px;
  background:#f9fafb;
  border:1px solid #e5e7eb;
  border-radius:8px;
  padding:6px;
  font-size:20px;
}

.emoji-panel span {
  cursor:pointer;
  margin:4px;
}

#backBtn {
  display:block;
  margin:24px auto;
  padding:10px 18px;
  background:#e6ecf0;
  border-radius:20px;
  text-decoration:none;
  color:#333;
  font-weight:600;
}
</style>
</head>

<body>

<div class="container">
  <div id="thread"></div>

  <div class="comment-box">
    <textarea id="userReply" placeholder="Write a reply..."></textarea>

    <div class="comment-controls">
      <button id="emojiToggle">ğŸ˜Š</button>
      <button id="postReply">Reply</button>
    </div>

    <div id="emojiPanel" class="emoji-panel">
      ğŸ˜€ ğŸ˜… ğŸ˜‚ ğŸ˜Š ğŸ˜ ğŸ¤” ğŸ˜¡ ğŸ˜¢ ğŸ‘ ğŸ‘ ğŸ‰ â¤ï¸ ğŸ”¥ ğŸ¤–
    </div>
  </div>

  <a id="backBtn" href="../index.html">â¬… Back to Timeline</a>
</div>

<script>
// -------- Helpers --------
function initials(name) {
  return name.split(/\s+/).map(w => w[0]).join("").slice(0,2).toUpperCase();
}

function colorFromName(name) {
  const colors = [
    "linear-gradient(135deg,#1f6feb,#3b82f6)",
    "linear-gradient(135deg,#10b981,#34d399)",
    "linear-gradient(135deg,#f59e0b,#fbbf24)",
    "linear-gradient(135deg,#ec4899,#f472b6)",
    "linear-gradient(135deg,#6366f1,#8b5cf6)"
  ];
  return colors[name.charCodeAt(0) % colors.length];
}

// -------- Load ID + State --------
const postId = new URLSearchParams(location.search).get("id");

let timelineState = JSON.parse(sessionStorage.getItem("timelineState") || "{}");

const state = timelineState[postId] ||= {
  likes:0,
  retweets:0,
  comments:[],
  liked:false,
  retweeted:false
};

function save() {
  timelineState[postId] = state;
  sessionStorage.setItem("timelineState", JSON.stringify(timelineState));
}

const thread = document.getElementById("thread");

// -------- Load Post --------
fetch("../data/posts.json")
  .then(r => r.json())
  .then(posts => {
    const post = posts.find(p => p.id === postId);

    if (!state.initialized) {
      state.likes = post.likes || 0;
      state.retweets = post.retweets || 0;
      state.initialized = true;
      save();
    }

    renderMainPost(post);
    renderAISummary(post);
    post.replies.forEach(r => renderReply(r));
    renderUserComments();
  });

// -------- Render Functions --------
function renderMainPost(p) {
  const el = document.createElement("article");
  el.className = "post";

  el.innerHTML = `
    <div class="avatar" style="background:${colorFromName(p.author)}">
      ${initials(p.author)}
    </div>
    <div class="content">
      <div class="meta">
        <span class="name">${p.author}</span>
        ${p.handle} Â· ${p.timestamp}
      </div>
      <div class="text">${p.text}</div>
      ${p.image ? `<img src="../${p.image}" class="thumb">` : ""}
    </div>
  `;

  thread.appendChild(el);
}

function renderAISummary(p) {
  const el = document.createElement("article");
  el.className = "post ai-summary";

  el.innerHTML = `
    <div class="avatar">ğŸ¤–</div>
    <div class="content">
      <div class="name">AI Summary</div>
      <div class="text">${p.aiSummary}</div>
    </div>
  `;

  thread.appendChild(el);
}

function renderReply(r) {
  const el = document.createElement("article");
  el.className = "post";

  el.innerHTML = `
    <div class="avatar" style="background:${colorFromName(r.author)}">
      ${initials(r.author)}
    </div>
    <div class="content">
      <div class="name">${r.author}</div>
      <div class="text">${r.text}</div>
    </div>
  `;

  thread.appendChild(el);
}

function renderUserComments() {
  state.comments.forEach(c => {
    const el = document.createElement("article");
    el.className = "post user-comment";

    el.innerHTML = `
      <div class="avatar" style="background:#2563eb">YOU</div>
      <div class="content">
        <div class="name">You</div>
        <div class="text">${c}</div>
      </div>
    `;

    thread.appendChild(el);
  });
}

// -------- Emoji Logic --------
const emojiToggle = document.getElementById("emojiToggle");
const emojiPanel = document.getElementById("emojiPanel");
const textarea = document.getElementById("userReply");

emojiToggle.onclick = () => {
  emojiPanel.style.display =
    emojiPanel.style.display === "block" ? "none" : "block";
};

emojiPanel.querySelectorAll("span").forEach(e => {
  e.onclick = () => {
    textarea.value += e.textContent;
    textarea.focus();
  };
});

// -------- Submit Reply --------
document.getElementById("postReply").onclick = () => {
  const txt = textarea.value.trim();
  if (!txt) return;
  state.comments.push(txt);
  textarea.value = "";
  save();
  location.reload();
};
</script>

</body>
</html>
