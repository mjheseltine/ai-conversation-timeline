<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Conversation View</title>
<style>
:root {
  --bg: #f6f7fb;
  --card: #fff;
  --muted: #6b7280;
  --accent: #1f6feb;
  --radius: 12px;
  --shadow: 0 4px 12px rgba(35, 40, 50, 0.08);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
body { background: var(--bg); margin: 20px; color: #111; }
.container { max-width: 800px; margin: 0 auto; }

.post {
  background: var(--card);
  border-radius: var(--radius);
  padding: 14px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  box-shadow: var(--shadow);
  transition: transform .15s ease;
}
.post:hover { transform: translateY(-2px); }

.avatar {
  width: 48px; height: 48px; border-radius: 50%;
  flex: 0 0 48px; display: grid; place-items: center;
  color: #fff; font-weight: 700; font-size: 14px;
  background: linear-gradient(135deg,#1f6feb,#3b82f6);
}
.content { flex: 1; }
.name { font-weight: 700; color: #0f1724; }
.text { margin-top: 6px; font-size: 15px; line-height: 1.45; color: #0f1724; }

.actions {
  margin-top: 10px; display: flex; gap: 20px; color: var(--muted); font-size: 14px;
}
.actions button {
  background: none; border: none; cursor: pointer;
  color: inherit; display: flex; align-items: center; gap: 4px;
  padding: 4px 6px; border-radius: 6px;
}
.actions button:hover { background: #f1f5f9; transform: scale(1.05); }
.actions button.liked { color: #e0245e; }
.actions button.retweeted { color: #17bf63; }

.comment-box { margin-top: 12px; }
.comment-box textarea {
  width: 100%; border-radius: 8px; border: 1px solid #e2e8f0;
  font-size: 14px; padding: 8px; resize: vertical;
}
.comment-section { margin-top: 12px; }
.reply {
  background: #f0f2f5; border-radius: 8px;
  padding: 6px 10px; margin-top: 6px; font-size: 0.9em;
}

.ai-summary {
  display: flex; gap: 10px; align-items: flex-start;
  background: #fffdf8; border: 1px solid #fbe5b3;
  padding: 12px; border-radius: 10px; box-shadow: var(--shadow);
  margin-top: 10px;
}
.ai-summary .avatar {
  background: linear-gradient(135deg,#6366f1,#8b5cf6);
}

#backBtn {
  display: block; width: fit-content;
  margin: 20px auto 0; background: #e6ecf0;
  color: #333; padding: 8px 16px;
  border-radius: 20px; text-decoration: none; font-weight: bold;
}
#backBtn:hover { background: #d8e2e7; }
</style>
</head>

<body>
<div class="container" id="conversation"></div>
<a href="../index.html" id="backBtn">‚¨ÖÔ∏è Back to Timeline</a>

<script>
// ---------- Configuration ----------
const postId = "post1";  // Change per file
const mainPost = {
  author: "User123",
  text: "Post claims Trump's policies hurt manufacturing while favoring Big Tech..."
};
const aiSummary = {
  author: "AI Summary ü§ñ",
  text: "Post criticizes Trump's manufacturing record while noting tech favoritism."
};
const replies = [
  { author: "PolicyNerd", text: "Both parties contributed to tech monopolies though." },
  { author: "EconGuy", text: "Reshoring takes time; this criticism oversimplifies things." },
  { author: "TechWatcher", text: "Honestly, this argument gets made every cycle." }
];

// ---------- Helpers ----------
function initials(name){return name.split(/\s+/).map(n=>n[0].toUpperCase()).slice(0,2).join("");}
function colorFromName(name){
  const colors = [
    "linear-gradient(135deg,#1f6feb,#3b82f6)",
    "linear-gradient(135deg,#10b981,#34d399)",
    "linear-gradient(135deg,#f59e0b,#fbbf24)",
    "linear-gradient(135deg,#ec4899,#f472b6)",
    "linear-gradient(135deg,#6366f1,#8b5cf6)"
  ];
  const i = name.charCodeAt(0) % colors.length;
  return colors[i];
}
function sendToQualtrics(type,data){window.parent.postMessage({type,data},"*");}

// ---------- State (per session) ----------
let state = JSON.parse(sessionStorage.getItem("postState_"+postId) || "{}");
if(!state.likes) state.likes=0;
if(!state.retweets) state.retweets=0;
if(!state.comments) state.comments=[];
if(typeof state.liked==="undefined") state.liked=false;
if(typeof state.retweeted==="undefined") state.retweeted=false;
save();
function save(){sessionStorage.setItem("postState_"+postId,JSON.stringify(state));}

// ---------- Render ----------
const convo = document.getElementById("conversation");
convo.innerHTML = "";

// Main post
convo.appendChild(createPost(mainPost,true));

// AI summary
convo.appendChild(createAISummary(aiSummary));

// Replies
replies.forEach(r => convo.appendChild(createPost(r,false)));

// User comments (if any)
renderUserComments();

// ---------- Post creation ----------
function createPost(data,isMain){
  const wrapper = document.createElement("article");
  wrapper.className = "post";
  const avatar = document.createElement("div");
  avatar.className = "avatar";
  avatar.style.background = colorFromName(data.author);
  avatar.textContent = initials(data.author);
  const content = document.createElement("div");
  content.className = "content";
  content.innerHTML = `<div class="name">${data.author}</div><div class="text">${data.text}</div>`;

  if(isMain){
    const actions = document.createElement("div");
    actions.className = "actions";
    actions.innerHTML = `
      <button class="like ${state.liked?"liked":""}">‚ù§Ô∏è <span>${state.likes}</span></button>
      <button class="retweet ${state.retweeted?"retweeted":""}">üîÅ <span>${state.retweets}</span></button>
      <button class="comment">üí¨ <span>${state.comments.length}</span></button>
    `;
    const commentBox = document.createElement("div");
    commentBox.className = "comment-box";
    commentBox.style.display = "none";
    commentBox.innerHTML = `
      <textarea rows="2" placeholder="Write a comment..."></textarea>
      <button style="margin-top:6px;background:var(--accent);color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;">Submit</button>
    `;
    const commentSection = document.createElement("div");
    commentSection.className = "comment-section";

    content.append(actions,commentBox,commentSection);

    // Buttons
    const [likeBtn,rtBtn,commentBtn] = actions.querySelectorAll("button");
    const submitBtn = commentBox.querySelector("button");
    const textarea = commentBox.querySelector("textarea");

    likeBtn.onclick = () => {
      state.liked = !state.liked;
      state.likes += state.liked ? 1 : -1;
      likeBtn.classList.toggle("liked",state.liked);
      likeBtn.querySelector("span").textContent = state.likes;
      save();
      sendToQualtrics("like",{post:postId,liked:state.liked});
    };

    rtBtn.onclick = () => {
      state.retweeted = !state.retweeted;
      state.retweets += state.retweeted ? 1 : -1;
      rtBtn.classList.toggle("retweeted",state.retweeted);
      rtBtn.querySelector("span").textContent = state.retweets;
      save();
      sendToQualtrics("retweet",{post:postId,retweeted:state.retweeted});
    };

    commentBtn.onclick = () => {
      commentBox.style.display = commentBox.style.display==="none" ? "block" : "none";
    };

    submitBtn.onclick = () => {
      const txt = textarea.value.trim();
      if(!txt) return;
      state.comments.push(txt);
      textarea.value="";
      commentBox.style.display="none";
      commentBtn.querySelector("span").textContent = state.comments.length;
      save();
      renderUserComments();
      sendToQualtrics("comment",{post:postId,text:txt});
    };
  }

  wrapper.append(avatar,content);
  return wrapper;
}

// ---------- AI Summary creation ----------
function createAISummary(ai){
  const el=document.createElement("div");
  el.className="ai-summary";
  el.innerHTML=`
    <div class="avatar">ü§ñ</div>
    <div class="content">
      <div class="name">${ai.author}</div>
      <div class="text">${ai.text}</div>
    </div>`;
  return el;
}

// ---------- Render user comments ----------
function renderUserComments(){
  const main = convo.querySelector(".post"); // first post
  const commentSection = main.querySelector(".comment-section");
  if(!commentSection) return;
  commentSection.innerHTML = state.comments.map(c=>`<div class="reply"><strong>You:</strong> ${c}</div>`).join("");
}
</script>
</body>
</html>
